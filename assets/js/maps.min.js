function initMap(){function e(){function e(e,t){if(""==document.getElementById("direccionReporte").value&&null!=t)t.setMap(null),map.setZoom(14),map.setCenter(centerMap),document.getElementById("lat").value="",document.getElementById("lng").value="";else{var a=document.getElementById("direccionReporte").value+" ,Tres de Febrero, Buenos Aires, Argentina";e.geocode({address:a},function(e,a){if(a===google.maps.GeocoderStatus.OK&&google.maps.geometry.poly.containsLocation(e[0].geometry.location,tresDeFebreroPol)){map.setCenter(e[0].geometry.location);var o,n,l,r=e[0].address_components;for(var i in r)r[i].types.indexOf("street_number")>-1&&(o=r[i].long_name),r[i].types.indexOf("route")>-1&&(n=r[i].long_name),r[i].types.indexOf("locality")>-1&&(l=r[i].long_name);void 0!=o&&(document.getElementById("lat").value=e[0].geometry.location.lat(),document.getElementById("lng").value=e[0].geometry.location.lng(),document.getElementById("alturaReporte").value=o,document.getElementById("calleReporte").value=n,document.getElementById("localidadReporte").value=l,null!=t&&t.setMap(null),t.setPosition(e[0].geometry.location),map.setZoom(16),t.setMap(map))}})}}geocoder=new google.maps.Geocoder;var t=document.getElementById("direccionReporte"),a=null,o=t.className;t.onkeyup=function(n){t.className=o+" searching",clearTimeout(a),a=setTimeout(function(){e(geocoder,markerReport),t.className=o},1e3)},google.maps.event.addListener(markerReport,"click",function(e){document.getElementById("lat").value=this.getPosition().lat(),document.getElementById("lng").value=this.getPosition().lng();({lat:parseFloat(this.getPosition().lat()),lng:parseFloat(this.getPosition().lng())});geocodeLatLng(geocoder,latLng)}),google.maps.event.addListener(markerReport,"dragend",function(e){var t={lat:parseFloat(this.getPosition().lat()),lng:parseFloat(this.getPosition().lng())};google.maps.geometry.poly.containsLocation(e.latLng,tresDeFebreroPol)?(document.getElementById("lat").value=this.getPosition().lat(),document.getElementById("lng").value=this.getPosition().lng(),geocodeLatLng(geocoder,t)):(markerReport.setMap(null),document.getElementById("direccionReporte").value="",document.getElementById("lat").value=0,document.getElementById("lng").value=0)});var n=document.getElementById("verDirecion");n.onclick=function(){e(geocoder,markerReport)},$("#form-carga").is(":visible")&&clicMapAvailable(),$("#btn-cargar").click(function(e){history.pushState("","","/reportes/cargar"),e.preventDefault(),$("#form-portada").hide(500),$("#form-carga").show(500,function(){$("#TdeFMap").addClass("form-active")}),$(".widged-right").hide(),markerReport.setVisible(!0),clicMapAvailable(),google.maps.event.trigger(map,"resize")}),$("#title, #volverReporte").click(function(e){history.pushState("","","/"),e.preventDefault(),$("#TdeFMap").removeClass("form-active"),$("#form-portada").show(500),$("#form-carga").hide(500),$(".widged-right").show(),markerReport.setVisible(!1),clicMapDisavailable(),google.maps.event.trigger(map,"resize")})}function t(e){var t=baseUrl+"listar/"+e,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState)for(var e=JSON.parse(o.responseText),t=e.length-1;t>=0;t--)a(e[t],t)},o.open("GET",t,!0),o.send()}function a(e,t){var a={lat:parseFloat(e.lat),lng:parseFloat(e.lng)},l='<div class="panel-heading"><h3 class="panel-title">'+e.titulo+'</h3></div><div class="panel-body text-center">';if(null!=e.imagen&&""!=e.imagen){var r=e.imagen.split(".");l+='<img class="img-responsive" src="'+baseUrl+"assets/subidas/thumbs/"+r[0]+"_thumb."+r[1]+'"><hr>'}l+='<p class="text-left">'+e.texto+'</p></div><div class="panel-footer"> <p><b>Direcci&oacute;n: </b>'+e.direccion+"</p>";var i=o+n[e.categoria];switch(e.estado){case"2":i+="_proceso";break;case"3":i+="_resuelto"}markers[t]=new google.maps.Marker({position:a,title:e.titulo,category:e.categoria,status:e.estado,icon:i+".png"}),google.maps.event.addListener(markers[t],"click",function(){infoBubble.setContent(l),infoBubble.open(map,markers[t])}),markers[t].setMap(map)}var o=baseUrl+"/assets/img/",n={0:"icon-0",1:"icon-1",2:"icon-2",3:"icon-3",4:"icon-4",5:"icon-5",6:"icon-6"},l=[{featureType:"landscape.man_made",stylers:[{color:"#dfe6eb"}]}];t("30"),markers=[],map=new google.maps.Map(document.getElementById("TdeFMap"),{zoom:14,scrollwheel:!1,scaleControl:!1,streetViewControl:!1,panControl:!1,mapTypeControl:!0,mapTypeControlOptions:{position:google.maps.ControlPosition.BOTTOM_LEFT},zoomControl:!0,styles:l,center:centerMap,mapTypeId:google.maps.MapTypeId.TERRAIN}),infoWindow=new google.maps.InfoWindow({maxWidth:200}),infoBubble=new InfoBubble({backgroundColor:"#0080B6",borderRadius:2,borderWidth:0,arrowSize:20,maxWidth:300,maxHeight:350,padding:0,hideCloseButton:!1,backgroundClassName:"panel panel-primary infoBubble",arrowStyle:0,ShadowStyle:0,closeSrc:o+"button_close.png"}),markerReport=new google.maps.Marker({id:"searchMarker",draggable:!0,icon:o+n[0]+"-big.png"});var r=[{lat:-34.61555,lng:-58.53104},{lat:-34.5975,lng:-58.5228},{lat:-34.59123,lng:-58.56254},{lat:-34.56949,lng:-58.58954},{lat:-34.55878,lng:-58.60332},{lat:-34.55344,lng:-58.61034},{lat:-34.54742,lng:-58.61916},{lat:-34.54728,lng:-58.62182},{lat:-34.54754,lng:-58.62409},{lat:-34.5496,lng:-58.6289},{lat:-34.55264,lng:-58.6316},{lat:-34.55547,lng:-58.63772},{lat:-34.5619,lng:-58.64468},{lat:-34.56892,lng:-58.63915},{lat:-34.57636,lng:-58.63035},{lat:-34.60791,lng:-58.59297},{lat:-34.60606,lng:-58.58884},{lat:-34.62872,lng:-58.57232},{lat:-34.62595,lng:-58.56677},{lat:-34.63334,lng:-58.55772},{lat:-34.63693,lng:-58.55328},{lat:-34.64059,lng:-58.54832},{lat:-34.65439,lng:-58.52902}];tresDeFebreroPol=new google.maps.Polygon({paths:r,strokeColor:"#f4811f",strokeOpacity:.8,strokeWeight:2,fillColor:"#003366",fillOpacity:.1}),tresDeFebreroPol.setMap(map),e(),google.maps.event.addListenerOnce(map,"idle",function(){google.maps.event.trigger(map,"resize")});var i=document.getElementById("lat").value,s=document.getElementById("lng").value,g=document.getElementById("caregoriasReporte").value;if(""!=i&&""!=s){var c={lat:parseFloat(i),lng:parseFloat(s)};markerReport.setPosition(c),markerReport.setMap(map),map.setCenter(c),""!=g&&(window.setTimeout(function(){markerReport.setAnimation(google.maps.Animation.DROP),200}),iconUrl=o+n[g]+"-big.png",markerReport.setIcon(iconUrl))}for(var m=document.querySelectorAll(".btn-categoria"),d=0,p=m.length;p>d;d++)m[d].onclick=function(){var e=this.id.split("-")[1];if(null!=e&&void 0!=e)for(var t=markers.length-1;t>=0;t--)markers[t].category!=e||(" "+this.className+" ").replace(/[\n\t]/g," ").indexOf("active")>-1?markers[t].category==e&&markers[t].setVisible(!1):markers[t].setVisible(!0);(" "+this.className+" ").replace(/[\n\t]/g," ").indexOf("active")>-1?this.className=this.className.replace(/\bactive\b/,""):this.className=this.className+" active"};for(var u=document.getElementById("periodo").getElementsByTagName("li"),d=0,p=u.length;p>d;d++)u[d].onclick=function(e){e.preventDefault();var a=this.id.split("-")[1];if(this.className="",null!=a&&void 0!=a){for(var o=markers.length-1;o>=0;o--)markers[o].setMap(null);for(var n=0,l=u.length;l>n;n++)u[n].className="";this.className="active",t(a);for(var r=document.querySelectorAll(".btn-categoria"),o=0,l=r.length;l>o;o++)r[o].className=r[o].className+" active";for(var i=document.getElementById("status").getElementsByTagName("li"),o=0,l=i.length;l>o;o++)i[o].className=""}};for(var v=document.getElementById("status").getElementsByTagName("li"),d=0,p=v.length;p>d;d++)v[d].onclick=function(e){e.preventDefault();var t=this.id.split("-")[1];if(null==t||void 0==t||(" "+this.className+" ").replace(/[\n\t]/g," ").indexOf("active")>-1){for(var a=markers.length-1;a>=0;a--)markers[a].setMap(map);for(var o=0,n=v.length;n>o;o++)v[o].className=""}else{for(var a=markers.length-1;a>=0;a--)markers[a].status==t?markers[a].setMap(map):markers[a].setMap(null);for(var o=0,n=v.length;n>o;o++)v[o].className="";this.className="active"}};var m=document.getElementById("caregoriasReporte");m.onchange=function(){var e=this.value,t=o+n[0]+"-big.png";null!=e&&void 0!=e&&(t=o+n[e]+"-big.png"),markerReport.setAnimation(google.maps.Animation.BOUNCE),markerReport.setIcon(t),setTimeout(function(){markerReport.setAnimation(null)},1e3)}}function clicMapAvailable(){google.maps.event.addListener(tresDeFebreroPol,"click",function(e){infoBubble.close(),markerReport.setPosition(e.latLng),markerReport.setMap(map),geocodeLatLng(geocoder,e.latLng),document.getElementById("lat").value=markerReport.getPosition().lat(),document.getElementById("lng").value=markerReport.getPosition().lng()})}function clicMapDisavailable(){google.maps.event.clearListeners(tresDeFebreroPol,"click")}function geocodeLatLng(e,t){e.geocode({location:t},function(e,t){if(t===google.maps.GeocoderStatus.OK&&e[0]){var a,o,n,l=e[0].address_components;for(var r in l)l[r].types.indexOf("street_number")>-1&&(a=l[r].long_name),l[r].types.indexOf("route")>-1&&(o=l[r].long_name),l[r].types.indexOf("locality")>-1&&(n=l[r].long_name);void 0!=a&&(document.getElementById("alturaReporte").value=a,document.getElementById("calleReporte").value=o,document.getElementById("localidadReporte").value=n,document.getElementById("direccionReporte").value=e[0].formatted_address)}})}